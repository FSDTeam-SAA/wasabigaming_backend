<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Login - Role Selection</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 450px;
        width: 100%;
        padding: 40px;
        animation: slideUp 0.5s ease;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      .header h1 {
        color: #333;
        font-size: 28px;
        margin-bottom: 10px;
      }
      .header p {
        color: #666;
        font-size: 14px;
      }

      .profile-section {
        text-align: center;
        margin-bottom: 30px;
      }

      .profile-image {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin: 0 auto 15px;
        border: 3px solid #667eea;
        object-fit: cover;
        display: block;
      }

      .profile-name {
        font-size: 22px;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }
      .profile-email {
        color: #666;
        font-size: 14px;
      }

      .google-login-wrapper {
        display: flex;
        justify-content: center;
        margin: 30px 0;
      }

      /* ‚îÄ‚îÄ Role Selection ‚îÄ‚îÄ */
      .role-selection {
        display: none;
      }
      .role-selection.active {
        display: block;
        animation: slideUp 0.5s ease;
      }

      .role-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        text-align: center;
      }

      .role-option {
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }
      .role-option:hover {
        border-color: #667eea;
        background: #f8f9ff;
        transform: translateX(5px);
      }
      .role-option.selected {
        border-color: #667eea;
        background: #f0f3ff;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        transform: scale(1.02);
      }
      .role-option input[type='radio'] {
        position: absolute;
        opacity: 0;
      }

      .role-header {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }

      .radio-custom {
        width: 20px;
        height: 20px;
        border: 2px solid #ccc;
        border-radius: 50%;
        margin-right: 12px;
        position: relative;
        transition: all 0.3s ease;
        flex-shrink: 0;
      }
      .role-option.selected .radio-custom {
        border-color: #667eea;
        background: #667eea;
      }
      .role-option.selected .radio-custom::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 8px;
        height: 8px;
        background: white;
        border-radius: 50%;
      }

      .role-name {
        font-size: 16px;
        font-weight: 600;
        color: #333;
      }
      .role-description {
        color: #666;
        font-size: 13px;
        margin-left: 32px;
      }

      /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
      .btn {
        width: 100%;
        padding: 15px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
      }
      .btn-primary:disabled {
        background: #ccc;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .btn-secondary {
        background: #fff;
        color: #667eea;
        border: 2px solid #667eea;
      }
      .btn-secondary:hover {
        background: #f8f9ff;
        transform: translateY(-2px);
      }

      /* ‚îÄ‚îÄ Info box ‚îÄ‚îÄ */
      .info-box {
        background: #f0f3ff;
        border-left: 4px solid #667eea;
        padding: 15px;
        margin-top: 25px;
        border-radius: 8px;
      }
      .info-box h3 {
        font-size: 14px;
        color: #333;
        margin-bottom: 10px;
      }
      .info-box ul {
        list-style: none;
        padding-left: 0;
      }
      .info-box li {
        color: #666;
        font-size: 13px;
        margin-bottom: 8px;
        padding-left: 20px;
        position: relative;
      }
      .info-box li::before {
        content: '‚úì';
        position: absolute;
        left: 0;
        color: #667eea;
        font-weight: bold;
      }

      /* ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ */
      .user-dashboard {
        display: none;
      }
      .user-dashboard.active {
        display: block;
        animation: slideUp 0.5s ease;
      }

      .user-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 25px;
        text-align: center;
      }
      .user-card .profile-image {
        border-color: white;
        margin-bottom: 15px;
      }

      .user-info {
        background: #f8f9ff;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
      }
      .user-info-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e0e0e0;
      }
      .user-info-item:last-child {
        border-bottom: none;
      }
      .user-info-label {
        color: #666;
        font-weight: 500;
      }
      .user-info-value {
        color: #333;
        font-weight: 600;
        text-transform: capitalize;
      }

      /* ‚îÄ‚îÄ Loading ‚îÄ‚îÄ */
      .loading {
        text-align: center;
        color: #667eea;
        margin-top: 15px;
        font-size: 14px;
      }
      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .hidden {
        display: none !important;
      }

      /* ‚îÄ‚îÄ Messages ‚îÄ‚îÄ */
      .error-message {
        background: #fee;
        border-left: 4px solid #f44;
        padding: 15px;
        margin-top: 15px;
        border-radius: 8px;
        color: #c33;
        animation: shake 0.5s;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-10px);
        }
        75% {
          transform: translateX(10px);
        }
      }
      .success-message {
        background: #efe;
        border-left: 4px solid #4f4;
        padding: 15px;
        margin-top: 15px;
        border-radius: 8px;
        color: #383;
        animation: slideUp 0.5s ease;
      }

      /* ‚îÄ‚îÄ Badges ‚îÄ‚îÄ */
      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 8px;
      }
      .badge-new {
        background: #ffd700;
        color: #333;
      }
      .badge-returning {
        background: #4caf50;
        color: white;
      }

      @media (max-width: 480px) {
        .container {
          padding: 25px;
        }
        .header h1 {
          font-size: 24px;
        }
        .profile-image {
          width: 60px;
          height: 60px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           LOGIN SCREEN
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div id="loginScreen">
        <div class="header">
          <h1>üéì Welcome Back</h1>
          <p>Sign in with your Google account to continue</p>
        </div>

        <div class="google-login-wrapper">
          <div
            id="g_id_onload"
            data-client_id="523519229268-rshgm9meiom6f69er3vhevo2jctsili3.apps.googleusercontent.com"
            data-callback="handleCredentialResponse"
          ></div>
          <div
            class="g_id_signin"
            data-type="standard"
            data-size="large"
            data-theme="outline"
            data-text="sign_in_with"
            data-shape="rectangular"
            data-logo_alignment="left"
          ></div>
        </div>

        <div id="loadingIndicator" class="loading hidden">
          <div class="spinner"></div>
          <p>Processing your login...</p>
        </div>

        <div id="errorMessage" class="error-message hidden"></div>
        <div id="successMessage" class="success-message hidden"></div>

        <div class="info-box">
          <h3>How it works:</h3>
          <ul>
            <li>
              <strong>First-time users:</strong> Select your role after Google
              login
            </li>
            <li>
              <strong>Existing users:</strong> Direct login with your existing
              role
            </li>
            <li><strong>Your role is permanent</strong> once set</li>
          </ul>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           ROLE SELECTION SCREEN
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div id="roleSelectionScreen" class="role-selection">
        <div class="profile-section">
          <img
            id="roleProfileImage"
            src=""
            alt="Profile"
            class="profile-image"
          />
          <div class="profile-name">
            <span id="roleProfileName"></span>
            <span class="badge badge-new">NEW USER</span>
          </div>
          <div class="profile-email" id="roleProfileEmail"></div>
        </div>

        <div class="role-title">
          üëã Welcome! Please select your role to continue
        </div>

        <div id="roleOptions">
          <div class="role-option" data-role="student">
            <input type="radio" name="role" id="student" value="student" />
            <div class="role-header">
              <div class="radio-custom"></div>
              <div class="role-name">üéì Student</div>
            </div>
            <div class="role-description">
              Access courses and learning materials
            </div>
          </div>

          <div class="role-option" data-role="school">
            <input type="radio" name="role" id="school" value="school" />
            <div class="role-header">
              <div class="radio-custom"></div>
              <div class="role-name">üè´ School</div>
            </div>
            <div class="role-description">Manage school and create courses</div>
          </div>

          <div class="role-option" data-role="admin">
            <input type="radio" name="role" id="admin" value="admin" />
            <div class="role-header">
              <div class="radio-custom"></div>
              <div class="role-name">üëë Admin</div>
            </div>
            <div class="role-description">Full administrative access</div>
          </div>
        </div>

        <button id="submitRoleBtn" class="btn btn-primary" disabled>
          Continue ‚Üí
        </button>

        <div id="roleLoadingIndicator" class="loading hidden">
          <div class="spinner"></div>
          <p>Creating your account...</p>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           USER DASHBOARD
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div id="userDashboard" class="user-dashboard">
        <div class="user-card">
          <img
            id="dashboardProfileImage"
            src=""
            alt="Profile"
            class="profile-image"
          />
          <div class="profile-name">
            <span id="dashboardProfileName"></span>
            <span class="badge badge-returning">RETURNING USER</span>
          </div>
        </div>

        <div class="user-info">
          <div class="user-info-item">
            <span class="user-info-label">üìß Email:</span>
            <span class="user-info-value" id="dashboardEmail"></span>
          </div>
          <div class="user-info-item">
            <span class="user-info-label">üë§ Role:</span>
            <span class="user-info-value" id="dashboardRole"></span>
          </div>
          <div class="user-info-item">
            <span class="user-info-label">‚úÖ Status:</span>
            <span class="user-info-value" style="color: #4caf50">Active</span>
          </div>
        </div>

        <button id="logoutBtn" class="btn btn-secondary">üö™ Logout</button>
      </div>
    </div>
    <!-- /.container -->

    <script>
      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         CONFIG
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      const API_BASE_URL = 'http://localhost:5000/api/v1/auth';

      // cachedIdToken ‚Äî role submit ‡¶è‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá
      let cachedIdToken = null;
      let selectedRole = null;

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         HELPERS
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      function showError(message) {
        const el = document.getElementById('errorMessage');
        el.textContent = '‚ùå ' + message;
        el.classList.remove('hidden');
        setTimeout(() => el.classList.add('hidden'), 5000);
      }

      function showSuccess(message) {
        const el = document.getElementById('successMessage');
        el.textContent = '‚úÖ ' + message;
        el.classList.remove('hidden');
        setTimeout(() => el.classList.add('hidden'), 3000);
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         CORE ‚Äî ‡¶è‡¶ï‡¶ü‡¶æ‡¶á API call function
         role = null   ‚Üí ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ (existing user check)
         role = string ‚Üí ‡¶®‡¶§‡ßÅ‡¶® user registration
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      async function doGoogleLogin(idToken, role) {
        const loading = document.getElementById('loadingIndicator');
        loading.classList.remove('hidden');

        try {
          // body ‡¶§‡ßá role ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶ì, ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ idToken
          const body = role ? { idToken, role } : { idToken };

          const res = await fetch(`${API_BASE_URL}/google-login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify(body),
          });

          const data = await res.json();
          console.log('üì• Response:', data);

          if (!data.success) {
            showError(data.message || 'Login failed');
            return;
          }

          if (data.data.needsRole) {
            // üÜï ‡¶®‡¶§‡ßÅ‡¶® user ‚Üí role selection ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
            console.log('üÜï New user ‚Äî showing role selection');
            showRoleSelectionScreen(data.data);
          } else {
            // ‚úÖ existing user login / new user registered
            const isNew = data.data.status === 'registered';
            showSuccess(
              isNew ? 'Account created! Welcome üéâ' : 'Welcome back! üëã',
            );
            setTimeout(() => showDashboard(data.data), 500);
          }
        } catch (err) {
          console.error('‚ùå Error:', err);
          showError('Connection error. Please try again.');
        } finally {
          loading.classList.add('hidden');
        }
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         GOOGLE CALLBACK ‚Äî ‡¶™‡ßç‡¶∞‡¶•‡¶Æ call (role ‡¶õ‡¶æ‡¶°‡¶º‡¶æ)
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      async function handleCredentialResponse(response) {
        cachedIdToken = response.credential; // token save ‡¶ï‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßã
        await doGoogleLogin(cachedIdToken, null);
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCREEN: Role Selection
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      function showRoleSelectionScreen(data) {
        const info = data.userInfo;

        document.getElementById('roleProfileImage').src =
          info.profileImage || 'https://via.placeholder.com/80';
        document.getElementById('roleProfileName').textContent =
          `${info.firstName} ${info.lastName}`;
        document.getElementById('roleProfileEmail').textContent = info.email;

        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('roleSelectionScreen').classList.add('active');
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SCREEN: Dashboard
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      function showDashboard(data) {
        // token save ‡¶ï‡¶∞‡ßã
        localStorage.setItem('accessToken', data.accessToken);

        const u = data.user;
        document.getElementById('dashboardProfileImage').src =
          u.profileImage || 'https://via.placeholder.com/80';
        document.getElementById('dashboardProfileName').textContent =
          `${u.firstName} ${u.lastName}`;
        document.getElementById('dashboardEmail').textContent = u.email;
        document.getElementById('dashboardRole').textContent = u.role;

        document.getElementById('loginScreen').classList.add('hidden');
        document
          .getElementById('roleSelectionScreen')
          .classList.remove('active');
        document.getElementById('userDashboard').classList.add('active');

        console.log('‚úÖ Dashboard loaded ‚Äî', u.email, '| Role:', u.role);

        // Optional: role ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ redirect ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá uncomment ‡¶ï‡¶∞‡ßã
        // const redirects = { student: '/student/dashboard', school: '/school/dashboard', admin: '/admin/dashboard' };
        // window.location.href = redirects[u.role] || '/dashboard';
      }

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         ROLE OPTION CLICK
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      const roleOptions = document.querySelectorAll('.role-option');
      const submitRoleBtn = document.getElementById('submitRoleBtn');

      roleOptions.forEach((option) => {
        option.addEventListener('click', function () {
          roleOptions.forEach((opt) => opt.classList.remove('selected'));
          this.classList.add('selected');
          selectedRole = this.getAttribute('data-role');
          submitRoleBtn.disabled = false;
          console.log('üéØ Role selected:', selectedRole);
        });
      });

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SUBMIT ROLE ‚Äî same API, ‡¶è‡¶¨‡¶æ‡¶∞ role ‡¶∏‡¶π
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      submitRoleBtn.addEventListener('click', async function () {
        if (!selectedRole) {
          showError('Please select a role');
          return;
        }
        if (!cachedIdToken) {
          showError('Session expired. Please sign in with Google again.');
          // Login screen ‡¶è ‡¶´‡ßá‡¶∞‡¶§ ‡¶™‡¶æ‡¶†‡¶æ‡¶ì
          document
            .getElementById('roleSelectionScreen')
            .classList.remove('active');
          document.getElementById('loginScreen').classList.remove('hidden');
          return;
        }

        const roleLoading = document.getElementById('roleLoadingIndicator');
        roleLoading.classList.remove('hidden');
        submitRoleBtn.disabled = true;

        try {
          console.log('üì§ Submitting role:', selectedRole);
          // same doGoogleLogin ‚Äî ‡¶è‡¶¨‡¶æ‡¶∞ role ‡¶∏‡¶π
          await doGoogleLogin(cachedIdToken, selectedRole);
        } finally {
          roleLoading.classList.add('hidden');
          submitRoleBtn.disabled = false;
        }
      });

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         LOGOUT
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      document
        .getElementById('logoutBtn')
        .addEventListener('click', function () {
          console.log('üö™ Logging out...');

          localStorage.removeItem('accessToken');
          cachedIdToken = null;
          selectedRole = null;

          document.getElementById('userDashboard').classList.remove('active');
          document.getElementById('loginScreen').classList.remove('hidden');

          // role selection reset
          roleOptions.forEach((opt) => opt.classList.remove('selected'));
          submitRoleBtn.disabled = true;

          showSuccess('Logged out successfully!');
        });

      /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         PAGE LOAD ‚Äî existing token check
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
      window.addEventListener('DOMContentLoaded', () => {
        const token = localStorage.getItem('accessToken');
        if (token) {
          console.log(
            'üîë Token found ‚Äî user must re-authenticate for a fresh session',
          );
          // ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá /verify-token API call ‡¶ï‡¶∞‡ßá auto-login ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã
        }
      });
    </script>
  </body>
</html>
